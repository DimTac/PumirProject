<!DOCTYPE html>
<html>
  <head>
    <title>Place searches</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <style>
      html, body, #map-canvas {
        height: 100%;
        margin: 0px;
        padding: 0px
      }
      #resultats
      {
        display:none;
      }
      #mapbox { position:absolute; width:100%; }

    #map { width:100%;height:600px; }
    </style>

  <!-- Bootstrap Twitter -->
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" href="css/bootstrap.min.css">
  <link rel="stylesheet" href="css/bootstrap-theme.min.css">

  <!-- GoogleMaps c'est old school vive MapBox -->
  <script src="http://cdn.leafletjs.com/leaflet-0.6/leaflet.js"></script>
  <link href='http://api.tiles.mapbox.com/mapbox.js/v1.4.0/mapbox.css' rel='stylesheet' />
  <script src='http://api.tiles.mapbox.com/mapbox.js/v1.4.0/mapbox.standalone.js'></script>

  <!-- JS Scripts -->
  <script src="http://codeorigin.jquery.com/jquery-1.10.2.min.js"></script>
  <script src="js/bootstrap.js"></script>    
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=true&libraries=places"></script>
  

  </head>
  <body>
    <div id="resultats"></div>
    <div id="map" class="dark"></div>
<div id="geolocate"></div>
<script type='text/javascript'>
 //var map = L.mapbox.map('map', 'examples.map-9ijuk24y').setView([48.82 ,2.38], 11);
</script>
  <script type="text/javascript">

var jsonObj = [];
var latitude ;
var longitude ;

function erreurPosition()
{
  alert("Activez la geolocalisation");
}

// Fonction de callback en cas de succès
function affichePosition(position){
    latitude = position.coords.latitude;
    longitude = position.coords.longitude; 
}

/**
* Fait le test si le navigateur supporte la géolocalisation
*/ 
if(navigator.geolocation) 
{
  navigator.geolocation.getCurrentPosition(affichePosition,erreurPosition);
}

 

//Initialisation de l'API Maps
google.maps.event.addDomListener(window, 'load', initialize);

function tr(json)
{
  //console.debug(json);
  for (var i = 0; i < json.length; i++)
  {
    jsonObj.push({
      type:'Feature',
      geometry:
      {
        type:'Point',
         // coordinates here are in longitude, latitude order because
        coordinates: [json[i].geometry.location.mb,json[i].geometry.location.lb]
      },
      properties:
      {
        title: json[i].name,
        description: 'Description',
        'marker-size': 'medium',
        'marker-color':'#046380',
        'marker-symbol': 'restaurant'
      }
    });
  }
  return jsonObj;
}

function initialize() {
  
  //Declaration de la position
  var position = new google.maps.LatLng(48.853526, 2.379934);
  //Declaration d'un objet carte
  tap = new google.maps.Map(document.getElementById('resultats'));
  //Requete
  var request = {
    location: position,
    radius: 200,
    types: ['food']
  };
  //Declaration de l'objet service
  var service = new google.maps.places.PlacesService(tap);
  service.nearbySearch(request, callback);
}

function callback(json, status) {
  jsonObj=tr(json);
  var map = L.mapbox.map('map', 'examples.map-9ijuk24y').setView([48.82 ,2.4534118], 12);
  L.mapbox.markerLayer(jsonObj).addTo(map);
}

    </script>
  </body>
</html>