<!DOCTYPE html>
<html lang="fr">
<head>
  <title>API YELP</title>
  <meta charset="utf-8">

  <!-- Bootstrap Twitter -->
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" href="css/bootstrap.min.css">
  <link rel="stylesheet" href="css/bootstrap-theme.min.css">

  <!-- GoogleMaps c'est old school vive MapBox -->
  <script src="http://cdn.leafletjs.com/leaflet-0.6/leaflet.js"></script>
  <link href='http://api.tiles.mapbox.com/mapbox.js/v1.3.1/mapbox.css' rel='stylesheet' />
  <script src='http://api.tiles.mapbox.com/mapbox.js/v1.3.1/mapbox.standalone.js'></script>

  <!-- JS Scripts -->
  <script src="http://codeorigin.jquery.com/jquery-1.10.2.min.js"></script>
  <script src="js/bootstrap.js"></script>

  <style>
    body { margin:0; padding:0; }
    #map { width:100%;height:400px; }
  </style>

  </head>

<body>
  <div class="container">
  <div class="navbar navbar-default"><div class="navbar-header"><a class="navbar-brand" href="#">API Yelp</a></div>
  </div>

  <div id="resultats"></div>
    
  <script type="text/javascript">

  if(navigator.geolocation) 
  {
    // Fonction de callback en cas de succès
    function affichePosition(position) 
    {
      jQuery(document).ready(function($) 
      { 
        //Récupération des données depuis l'API yelp
        $.ajax(
        { 
          url : "http://api.yelp.com/business_review_search?lat="+position.coords.latitude+"&long="+position.coords.longitude+"&radius=5&limit=5&ywsid=PECjTRZ2qNn-hwd4VzqWwA&category=bakeries",
          dataType : "jsonp", 
          success : function(parsed_json) 
          { 
            for (var i = 0; i < parsed_json['businesses'].length; i++) 
            {
              //  Remplissage du contenu
              $('#resultats').append("<p>"+parsed_json['businesses'][i]['name']+"</p>"+
                "<p><img src='"+parsed_json['businesses'][i]['rating_img_url']+"'/></p>"+
                "<p>"+parsed_json['businesses'][i]['address1']+" "+parsed_json['businesses'][i]['zip']+" "+parsed_json['businesses'][i]['city']+"</p>"+"<br>");              
            };
          }
        }); 
      });  
    }

    // Fonction de callback en cas d’erreur
    function erreurPosition(error) {
      var info = "Erreur lors de la géolocalisation : ";
      switch(error.code) {
      case error.TIMEOUT:
        info += "Timeout !";
      break;
      case error.PERMISSION_DENIED:
        info += "Vous n’avez pas donné la permission";
      break;
      case error.POSITION_UNAVAILABLE:
        info += "La position n’a pu être déterminée";
      break;
      case error.UNKNOWN_ERROR:
        info += "Erreur inconnue";
      break;
      }
    }

    navigator.geolocation.getCurrentPosition(affichePosition,erreurPosition);

  } 
  else 
  {
    alert("Ce navigateur ne supporte pas la géolocalisation");
  }
  </script>

<!--//https://api.foursquare.com/v2/venues/search?client_id=R21TO35023CYTYLFMTCZUBDPGQMZVJKFXOYYFB5NJ1GNKSJZ&client_secret=OFXSG15TZOGK5IHHNV1K55HG03UOKLSHLX0I3WFI2RGJBLMB&v=20130815&ll=48.751989673430685,2.453483282054402&categoryID=4bf58dd8d48988d1e9941735-->
  </div>
  </body>
</html>