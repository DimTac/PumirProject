<!--
To change this template, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE html>
<html>
    <head>
        <title>La roue !</title>
        <meta charset='utf-8' />
        <meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible' />
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <link href="css/style.css" rel="stylesheet">
        <link href='http://fonts.googleapis.com/css?family=Carter+One' rel='stylesheet' type='text/css' />
        <link href='http://fonts.googleapis.com/css?family=Raleway' rel='stylesheet' type='text/css'>

          <!-- GoogleMaps c'est old school vive MapBox -->
          <script src="http://cdn.leafletjs.com/leaflet-0.6/leaflet.js"></script>
          <link href='http://api.tiles.mapbox.com/mapbox.js/v1.4.0/mapbox.css' rel='stylesheet' />
          <script src='http://api.tiles.mapbox.com/mapbox.js/v1.4.0/mapbox.standalone.js'></script>

          <!-- JS Scripts -->
          <script src="http://codeorigin.jquery.com/jquery-1.10.2.min.js"></script>
          <script src="js/bootstrap.js"></script>    
            <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=true&libraries=places"></script>
            
        <!--[if IE]><script type="text/javascript" src="js/excanvas.js"></script><![endif]-->
    </head>
    <body>
        <div id="roue">
               <canvas id="canvas" width="500" height="500"></canvas>
        </div>

        <div id="affichage">
            <div id="panel">
                <div id="panel-roue">
                  <div id="transport">
                    <input type="button" value="Avec transport">
                    <input type="button" value="Sans transport">
                    <div>
                      <span>ou</span>
                    </div>
                  </div>
                  
                  <div id="budget">
                      <span>Mon budget pour aujourd'hui</span>
                      <input type="button" value="-" onclick="">
                      <div></div>
                      <input type="button" value="+" onclick="">
                  </div>
                  
                  <div id="choix">
                      <span>J'ai plutôt envie de manger</span>
                      <input type="button" value="Chinois" onclick="">
                      <input type="button" value="Japonais" onclick="">
                      <input type="button" value="Kebab" onclick="">
                      <input type="button" value="Brasserie" onclick="">
                      <input type="button" value="Pizza" onclick="">
                      <input type="button" value="Indien" onclick="">
                      <input type="button" value="Crêperie" onclick="">
                      <input type="button" value="Sandwich" onclick="">
                      <input type="button" value="Bio-tibétain" onclick="">
                      <input type="button" value="Chez maman" onclick="">
                  </div>
                  <input type="button" value="> Go!" onclick="spin();" />
                </div>

                <div id="panel-results">
                    <input type="button" value="Back" onclick="back();">
                    <p>COUCOU.</p>
                </div>
            </div>

            <div id="map">
                <div id="resultats"></div>
                    <div id="mapbox" class="dark"></div>
                <div id="geolocate"></div>
            </div>
        </div>

        <script src='http://ajax.googleapis.com/ajax/libs/jquery/1.6/jquery.js'></script>
        <script src='js/roueTourne.js'></script>
          <script type="text/javascript">

                var jsonObj = [];
                var latitude ;
                var longitude ;

                function erreurPosition()
                {
                  alert("Activez la geolocalisation");
                }

                // Fonction de callback en cas de succès
                function affichePosition(position){
                    latitude = position.coords.latitude;
                    longitude = position.coords.longitude; 
                }

                /**
                * Fait le test si le navigateur supporte la géolocalisation
                */ 
                if(navigator.geolocation) 
                {
                  navigator.geolocation.getCurrentPosition(affichePosition,erreurPosition);
                }

                 

                //Initialisation de l'API Maps
                google.maps.event.addDomListener(window, 'load', initialize);

                function tr(json)
                {
                  //console.debug(json);
                  for (var i = 0; i < json.length; i++)
                  {
                    jsonObj.push({
                      type:'Feature',
                      geometry:
                      {
                        type:'Point',
                         // coordinates here are in longitude, latitude order because
                        coordinates: [json[i].geometry.location.mb,json[i].geometry.location.lb]
                      },
                      properties:
                      {
                        title: json[i].name,
                        description: 'Description',
                        'marker-size': 'medium',
                        'marker-color':'#046380',
                        'marker-symbol': 'restaurant'
                      }
                    });
                  }
                  return jsonObj;
                }

                function initialize() {
                  
                  //Declaration de la position
                  var position = new google.maps.LatLng(48.853526, 2.379934);
                  //Declaration d'un objet carte
                  tap = new google.maps.Map(document.getElementById('resultats'));
                  //Requete
                  var request = {
                    location: position,
                    radius: 200,
                    types: ['food']
                  };
                  //Declaration de l'objet service
                  var service = new google.maps.places.PlacesService(tap);
                  service.nearbySearch(request, callback);
                }

                function callback(json, status) {
                  jsonObj=tr(json);
                  var map = L.mapbox.map('map', 'examples.map-9ijuk24y').setView([48.82 ,2.4534118], 12);
                  L.mapbox.markerLayer(jsonObj).addTo(map);
                }

                    </script>
    </body>
</html>

